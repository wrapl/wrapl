LIB_SRC = $(SRC_DIR)Lib/Lib/
LIB_OBJ = $(OBJ_DIR)Lib/Lib/

#CGeneratedFiles($(file include/gmp.h))

CGeneratedFiles($(DEV_INC)gcc/gmp.h)

libgmp.a:
	if $(not $(file-exists $(LIB_SRC)gmp/ChangeLog))
		mkdir(-p $(LIB_SRC)gmp)
		cd($(LIB_SRC)gmp, $(system wget -nv https://gmplib.org/download/gmp/gmp-6.0.0a.tar.bz2 -O- | tar xvjP --strip-components=1))
	mkdir(-p $(LIB_OBJ)gmp)
	if $(file-exists $(LIB_OBJ)gmp/Makefile)
		cd($(LIB_OBJ)gmp, $(system make distclean))
	cd($(LIB_OBJ)gmp, $(system $(LIB_SRC)/gmp/configure --disable-shared --enable-static --prefix=$(absname $(LIB_OBJ)) --libdir=$(absname $(LIB_OBJ)) ABI=32 CFLAGS="$(CFLAGS) -O2"))
	cd($(LIB_OBJ)gmp, $(system make clean))
	cd($(LIB_OBJ)gmp, $(system make))
	cd($(LIB_OBJ)gmp, $(system make install))

clean:
	rm(-f libgmp.a)

#$(file include/gmp.h): libgmp.a

$(DEV_INC)gcc/gmp.h: libgmp.a
	cp $(LIB_OBJ)include/gmp.h $@

Gmp.o: libgmp.a

section:
	LDFLAGS += Riva/Memory.rlib -d -xlibgmp.a -XGmp.exports
	RivaModuleAuto(Gmp, Gmp)

#-L/usr/lib/ -licuuc

section:
	LDFLAGS += \
		-L/usr/lib/gcc/i686-pc-linux-gnu/5.3.0/ \
		-Z -d \
		-xlibgcc.a \
		-xlibgcc_eh.a \
		-xlibc_nonshared.a \
		-xlibstdc++.a \
		-xlibsupc++.a \
		-xlibpthread.a \
		libpthread.rlib \
		-XGcc.exports
	RivaModuleAuto(Gcc, Gcc)

#		-xlibssp_nonshared.a \

