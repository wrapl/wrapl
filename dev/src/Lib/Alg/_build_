UUID_VERSION = "1.0.3"
UUID_DIR = file("libuuid-" .. UUID_VERSION)

CFLAGS = extend(CFLAGS, "-std=gnu99", "-Iinclude")
LDFLAGS = extend(LDFLAGS, "Std.rlib", "Riva.rlib", "Gmp.rlib", "Util/TypedFunction.rlib", "Sys/Module.rlib")
RDOCFLAGS = extend(RDOCFLAGS, "-I", file(""))

UUID_DIR:build(function()
	execute("wget -nv http://sourceforge.net/projects/libuuid/files/libuuid-" .. UUID_VERSION .. ".tar.gz/download -O- | tar xvzP")
end)

file("libuuid.a"){UUID_DIR}:build(function()
	execute{"cd", UUID_DIR, "&&",
		"./configure --disable-shared --enable-static",
		"--prefix=" .. file(""),
		"--libdir=" .. file(""),
		"CFLAGS=\"" .. stringify(CFLAGS) .. " -O2\"",
		"CXXFLAGS=\"" .. stringify(CXXFLAGS) .. " -O2\"",
		"--without-man-pages"
	}
	execute{"cd", UUID_DIR, "&&",
		"make mostlyclean"
	}
	execute{"cd", UUID_DIR, "&&",
		"make TARGET_LIBS=\"static\""
	}
	execute{"cd", UUID_DIR, "&&",
		"make install"
	}
end)

file("UUID.o"){file("libuuid.a")}

riva_module("Alg/Digest", {file("Digest.o"), file("crypt_blowfish.o"), file("crypt_gensalt.o"), file("wrapper.o"), file("x86.o")})
riva_module("Alg/Sign", {file("Sign.o")})
riva_module("Alg/UUID", {file("UUID.o")})