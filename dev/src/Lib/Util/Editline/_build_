EDITLINE_URL = "http://thrysoee.dk/editline/libedit-20160903-3.1.tar.gz"
local EDITLINE_DIR = file("libedit")


file("libedit.a"){EDITLINE_DIR}:build(function()
	execute{"cd", EDITLINE_DIR, "&&",
		"./configure --disable-shared --enable-static",
		"--prefix=" .. file(""),
		"--libdir=" .. file(""),
		"CFLAGS=\"-fdata-sections -ffunction-sections -Wstrict-aliasing -fno-pic -ftls-model=global-dynamic -w -O2\"",
		"--without-man-pages"
	}
	execute{"cd", EDITLINE_DIR, "&&",
		"make clean"
	}
	execute{"cd", EDITLINE_DIR, "&&",
		"make TARGET_LIBS=\"static\""
	}
	execute{"cd", EDITLINE_DIR, "&&",
		"make install"
	}
end)

EDITLINE_DIR:build(function()
	execute{"mkdir -p", EDITLINE_DIR}
	execute{"cd", EDITLINE_DIR, "&&",
		"wget --user-agent=\"Firefox/3.6.12\" -nv", EDITLINE_URL, "-O- | tar xvzP --strip-components=1"
	}
end)

scope("editline", function()
	CFLAGS = extend(CFLAGS, "-I", file("include"))
	LDFLAGS = extend(LDFLAGS, "Riva/Memory.rlib")
	file("Editline.o"){file("libedit.a")}
	riva_module("Util/Editline", {file("Editline.o")}, {file("libedit.a")})
end)