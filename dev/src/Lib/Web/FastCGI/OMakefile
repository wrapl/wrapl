FASTCGI_SRC = $(SRC_DIR)Lib/Web/FastCGI/
FASTCGI_OBJ = $(OBJ_DIR)Lib/Web/FastCGI/

libfcgi.a:
	if $(not $(file-exists $(FASTCGI_SRC)fcgi/README))
		mkdir(-p $(FASTCGI_SRC)fcgi)
		cd($(FASTCGI_SRC)fcgi, $(system wget -nv http://www.fastcgi.com/dist/fcgi.tar.gz -O- | tar xvzP --strip-components=1))
		cd($(FASTCGI_SRC)fcgi, $(system patch -p0 < ../fcgi.diff))
	mkdir(-p $(FASTCGI_OBJ)fcgi)
	if $(file-exists $(FASTCGI_OBJ)fcgi/Makefile)
		cd($(FASTCGI_OBJ)fcgi, $(system make distclean))
	cd($(FASTCGI_OBJ)fcgi, $(system $(FASTCGI_SRC)/fcgi/configure --disable-shared --enable-static --prefix=$(absname $(FASTCGI_OBJ)) --libdir=$(absname $(FASTCGI_OBJ)) CFLAGS="$(CFLAGS)"))
	cd($(FASTCGI_OBJ)fcgi, $(system make clean))
	cd($(FASTCGI_OBJ)fcgi, $(system make))
	cd($(FASTCGI_OBJ)fcgi, $(system make install))

clean:
	rm(-f libfcgi.a)

INCLUDES += $(FASTCGI_OBJ)include
LDFLAGS += Riva/Memory.rlib IO/Stream.rlib Util/TypedFunction.rlib

$(OUT_LIB)Web/FastCGI.riva: libfcgi.a

RivaModule(Web/FastCGI, Init)
