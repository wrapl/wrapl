local WEBSOCKET_DIR = file("libwebsockets")

WEBSOCKET_DIR:build(function()
	execute{"git", "clone", "git://git.libwebsockets.org/libwebsockets"}
end)

WEBSOCKET_LIB = WEBSOCKET_DIR/"lib/libwebsockets.a"

WEBSOCKET_LIB{WEBSOCKET_DIR}:build(function()
	execute{"cd", WEBSOCKET_DIR, "&&", "cmake", "."}
	execute{"cd", WEBSOCKET_DIR, "&&", "make"}
end)

scope("websockets", function()
	CFLAGS = extend(CFLAGS, "-I", WEBSOCKET_DIR)
	LDFLAGS = extend(LDFLAGS, "Riva/Memory.rlib", "IO/Stream.rlib", "Util/TypedFunction.rlib")
	file("WebSocket.o"){WEBSOCKET_LIB}
	riva_module("Web/WebSocket", {file("WebSocket.o")}, {WEBSOCKET_LIB})
end)
