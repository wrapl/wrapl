NOPOLL_VERSION = "0.4.3"
NOPOLL_URL = "https://github.com/ASPLes/nopoll/archive/" .. NOPOLL_VERSION .. ".tar.gz"
local NOPOLL_DIR = file("nopoll-" ..NOPOLL_VERSION)
local NOPOLL_LIB = file("libnopoll.a")

NOPOLL_LIB{NOPOLL_DIR}:build(function()
	execute{"cd", NOPOLL_DIR, "&&", "./autogen.sh"}
	execute{"cd", NOPOLL_DIR, "&&",
		"./configure --disable-shared --enable-static",
		"--prefix=" .. file(""),
		"--libdir=" .. file(""),
		"CFLAGS=\"" .. stringify(CFLAGS) .. " -O2\"",
		"--without-man-pages"
	}
	execute{"cd", NOPOLL_DIR, "&&", "make clean"}
	execute{"cd", NOPOLL_DIR, "&&", "make"}
	execute{"cd", NOPOLL_DIR, "&&", "make install"}
end)

NOPOLL_DIR{NOPOLL_ARCHIVE}:build(function()
	execute{"wget -nv", NOPOLL_URL, "-O- | tar xvzP"}
end)

scope("nopoll", function()
	file("NoPoll.o"){NOPOLL_LIB}
	CFLAGS = extend(CFLAGS, "-Iinclude")
	riva_module("Web/NoPoll", {file("NoPoll.o")}, {NOPOLL_LIB})
end)