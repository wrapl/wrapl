GIR_AUTOGEN = $(file Autogen.log)

CFLAGS += -std=gnu99 -w
LDFLAGS += Std.rlib Agg.rlib Riva.rlib

RivaProgram(Mapgen, Mapgen)

TypeMap.c: Autogen.log Mapgen.riva
	riva -L. Mapgen

RivaModule(Gir/TypeMap, TypeMap)

LDFLAGS += -L/usr/lib/ -L/lib/

if $(equal $(SYSNAME), CYGWIN_NT-5.1)
	LDFLAGS += -L/usr/bin/
	export

api.xml: $(file api.gir_list) Convert.wrapl
	riva -L $(dirname $(file Convert.wrapl)) Convert $(file api.gir_list) api.xml


if $(defined DOCS)
	Autogen.log: api.xml $(glob $(dirname $(file Main.wrapl))/*.wrapl)
		riva -DDOCS -L $(dirname $(file Main.wrapl))
	export
else
	Autogen.log: api.xml $(glob $(dirname $(file Main.wrapl))/*.wrapl)
		riva -L $(dirname $(file Main.wrapl))
	export

clean:
	rm(-f api.xml)
	rm(-f Autogen.log)
	rm(-f TypeMap.c)
	rm(-f Types.map)
	if $(file-exists FileList)
		scan(FileList)
		default
			rm(-f $0)
		rm(-f FileList)

mkdir(-p docs)

.DEFAULT: Autogen.log

DIRS = \
	GObject \
	GLib \
	Gio \
	Pango \
	Gdk \
	GdkX11 \
	GdkPixbuf \
	Gtk \
	GtkSource \
	Vte \
	GConf \
	Atk \
	GooCanvas \
	cairo

if $(file-exists Autogen.log)
	foreach(DIR, $(DIRS))
		mkdir(-p $(DIR))
		.SUBDIRS: $(DIR)
