UDIS_VERSION = "1.7"
local UDIS_DIR = file("udis86-" .. UDIS_VERSION)

file("libudis86.a"){UDIS_DIR}:build(function()
	execute{"cd", UDIS_DIR, "&&",
		"./configure --disable-shared --enable-static",
		"--prefix=" .. file(""),
		"--includedir=" .. file(""),
		"--libdir=" .. file(""),
		"CFLAGS=\"" .. stringify(CFLAGS) .. "\"",
		"--without-man-pages"
	}
	execute{"cd", UDIS_DIR, "&&",
		"make mostlyclean"
	}
	execute{"cd", UDIS_DIR, "&&",
		"make TARGET_LIBS=\"static\""
	}
	execute{"cd", UDIS_DIR, "&&",
		"make install"
	}
end)

UDIS_DIR:build(function()
	execute("wget -nv http://downloads.sourceforge.net/project/udis86/udis86/1.7/udis86-"  .. UDIS_VERSION .. ".tar.gz -O- | tar xvzP")
end)

LDFLAGS = extend(LDFLAGS, "-L.", "-lz", "-llua5.1", "-lbfd", "-lHX", "-ldl", "-liberty", "-g")
CFLAGS = extend(CFLAGS, "-DUSE_UDIS", "-g", "-DLINUX", "-w", "-std=gnu99", "-DPACKAGE", "-DPACKAGE_VERSION")

c_program(RLINK, {file("rlink.o")}, {file("libudis86.a")})