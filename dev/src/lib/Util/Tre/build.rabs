TRE_URL := "https://github.com/laurikari/tre.git"
var TRE_DIR := file("tre")
var TRE_LIB := (EXT_DIR / "lib/libtre.a") => fun() do
	TRE_DIR:rmdir
	execute("git clone", TRE_URL)
	TRE_DIR:chdir
	execute("./utils/autogen.sh")
	execute("./configure --disable-shared --enable-static",
		'--prefix={EXT_DIR}',
		"--disable-wchar",
		"--without-man-pages",
		'CFLAGS=\"{LIBCFLAGS}\"',
		'LDFLAGS=\"{LIBLDFLAGS}\"'
	)
	execute("make check")
	execute("make install")
end

LDFLAGS := old + ['-x{TRE_LIB}', "-XTre.exports"]

riva_module("Util/Tre", [file("Tre.o")], [TRE_LIB])