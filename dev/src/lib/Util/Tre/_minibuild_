TRE_URL := "https://github.com/laurikari/tre.git"
TRE_DIR := file("tre")

file("libtre.a")[TRE_DIR] => fun() do
	execute("cd", TRE_DIR, "&&", "./utils/autogen.sh")
	execute("cd", TRE_DIR, "&&",
		"./configure --disable-shared --enable-static",
		'--prefix={BUILDDIR}',
		'--libdir={BUILDDIR}',
		"--disable-wchar",
		"--without-man-pages",
		'CFLAGS=\"{LIBCFLAGS}\"',
		'LDFLAGS=\"{LIBLDFLAGS}\"'
	)
	execute("cd", TRE_DIR, "&&",
		"make check"
	)
	execute("cd", TRE_DIR, "&&",
		"make install"
	)
end

TRE_DIR => fun() do
	TRE_DIR:rmdir
	execute("git clone", TRE_URL)
end

LDFLAGS := old + ["-xlibtre.a", "-XTre.exports"]

riva_module("Util/Tre", [file("Tre.o")], [file("libtre.a")])