LINENOISE_VERSION := "1.0"

var LINENOISE_HEADER := file("linenoise.h") => fun() do
	var LINENOISE_DIR := file("linenoise")
	var LINENOISE_URL := 'https://github.com/antirez/linenoise/archive/{LINENOISE_VERSION}.tar.gz'
	LINENOISE_DIR:mkdir
	execute("cd", LINENOISE_DIR, "&&",
		"wget --user-agent=\"Firefox/3.6.12\" -nv", LINENOISE_URL, "-O- | tar xvzP --strip-components=1"
	)
	file("linenoise/linenoise.h"):copy(LINENOISE_HEADER)
end

var LINENOISE_SOURCE := file("linenoise.c")[LINENOISE_HEADER] => fun() do
	file("linenoise/linenoise.c"):copy(LINENOISE_SOURCE)
end

CFLAGS := old + ['-I{LINENOISE_SOURCE:dirname}']

riva_module("Util/Linenoise", [file("Linenoise.o"), file("linenoise.o")])