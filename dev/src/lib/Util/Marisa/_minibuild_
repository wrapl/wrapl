MARISA_DIR := file("marisa-trie") => fun(DIR) do
	execute('rm -rf {DIR}')
	execute("git clone https://github.com/s-yata/marisa-trie.git")
end

MARISA_LIB := file("libmarisa.a")[MARISA_DIR] => fun() do
	execute("cd", MARISA_DIR, "&& autoreconf -i")
	execute("cd", MARISA_DIR, "&& ./configure --disable-shared --enable-static",
		'--prefix={BUILDDIR}',
		'--libdir={BUILDDIR}',
		'CFLAGS=\"{LIBCFLAGS}\"',
		"--without-man-pages"
	)
	execute("cd", MARISA_DIR, "&&", "make")
	execute("cd", MARISA_DIR, "&&", "make install")
end

CXXFLAGS := old + ["-I", file("include")]
LDFLAGS := old + ["Riva/Memory.rlib"]
file("Marisa.o")[MARISA_LIB]
riva_module("Util/Marisa", [file("Marisa.o")], [MARISA_LIB])
